apiVersion: batch/v1
kind: Job
metadata:
  name: load-job
  namespace: pu-prod-load
spec:
  ttlSecondsAfterFinished: 120 # delete right after the pod terminates
  template:
    spec:
      containers:
      - name: wrk
        image: williamyeh/wrk
        env:
        - name: TEST_TIME  # 2s or 5m etc.
          value: '20s'
        - name: URL
          value: http://pu-prod-website-partsunlimited-website-blue.pu-prod.svc/site/ShoppingCart/AddToCart/
        - name: WEIGHTED_CATEGORY
          value: '5' # Oil
        - name: WEIGHTED_PERCENTAGE
          value: '80'
        command: ["wrk"]
        args: ["-d$(TEST_TIME)", "-s", "random-category.lua", "$(URL)", "--", "$(WEIGHTED_CATEGORY)", "$(WEIGHTED_PERCENTAGE)"]
        volumeMounts:
        - name: lua-script
          mountPath: /data
      volumes:
      - name: lua-script
        configMap:
          name: random-category-lua
      restartPolicy: Never